

\paragraph{}
We consider permutations of length $n$ .

For such permutation $a$, we define:
\begin{itemize}
\item{} the set $I(a)=\{k/ a[k]<a[k+1]\}$
\item{} $K(a)$ such that $K(a)= max(I(a))$ if $I(a)$ is not empty, $K(a)=n$ otherwise
\item{} the set $J(a)=\{l/ a[K(a)]<a[l]\}$
\item{} $L(a)$ such that $L(a) = max(J(a))$ if $J(a)$ is not empty, $L(a)=n$ otherwise
\end{itemize}

\paragraph{}
The cost of finding the next permutation is then:
\begin{itemize}
\item{} $n-K(a)-1$ to find $K(a)$
\item{} $n-K(a)-2$ at most to find the index $L(a)$ (because $L(a)$ is in the worst case $K(a)+1$)
\item{} $1$ to make the swap between $a[K(a)]$ and $a[L(a)]$
\item{} $n-K(a)-1$ to reverse the list in the range of $K(a)+1,..,n-1$
\end{itemize}
The real cost to find the next permutation is then (at most) of $3*(n-K(a)-1)$ .

\paragraph{}
Let the potential $\Phi(a)$ be the number of indices $k$ such that $a[k]>a[k+1]$
\newline
i.e $\Phi(a)=n-\#(I(a))$ .

\paragraph{}
When we find the next permutation, we don't change any element before $K(a)$. This part doesn't contribute to any change to the potential $\Phi(a)$. The only part that can contribute in a change of potential is the part beginning at $K(a)$.
\newline
(We note $a'$ the permutation after the swap of $a[K(a)]$ and $a[L(a)]$).
The swap of $a[K(a)]$ and $a[L(a)]$, contributes for a change between $-2$ and $0$ in the potential. This is because the indices $K(a)+1,..,n$ are such that $a[K(a)+1]>a[K(a)+2]>..>a[L(a)]>a[L(a)]$: after the swap we still have $a[L(a)]=a'[K(a)]<a'[K(a)+1]$, the only difference can come from the new relations between $a'[L(a)-1],a'[L(a)],a'[L(a)]$. We had $a[L(a)-1]>a[L(a)]>a[L(a)+1]$ but it may have changed.
\newline
Then by reversing the end of the list, the potential decreases by at least $n-K(a)-3\ $ because every index in $K(a)+1,..,n-1$ was not in $I(a)$ before swapping $a[K(a)]\ $ and $a[L(a)]\ $.
\newline
Thus we have $\Delta\Phi(a)\leq{3-(n-K(a))}$ .
\paragraph{}
Therefore, we have $realCost+3*\Delta\Phi=O(1)$. The operation runs in amortized constant time.